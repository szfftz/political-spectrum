(function(){"use strict";var t={5564:function(t,e,n){var o=n(5130),a=n(9364),i=n(6768);const l={class:"app-root d-flex flex-column",style:{height:"calc(var(--vh, 1vh) * 100)",overflow:"hidden"}},r={class:"d-flex flex-column overflow-hidden",style:{flex:"1","min-height":"0"}};function s(t,e,n,o,a,s){const c=(0,i.g2)("router-view");return(0,i.uX)(),(0,i.CE)("div",l,[(0,i.Lk)("div",r,[(0,i.bF)(c)])])}var c={name:"App",components:{},setup(){const t=()=>{const t=.01*window.innerHeight;document.documentElement.style.setProperty("--vh",`${t}px`)};let e=null;const n=()=>{e&&clearTimeout(e),e=setTimeout(()=>{t()},100)};return(0,i.sV)(()=>{t(),window.addEventListener("resize",n),window.addEventListener("orientationchange",t),document.addEventListener("visibilitychange",t)}),(0,i.hi)(()=>{window.removeEventListener("resize",n),window.removeEventListener("orientationchange",t),document.addEventListener("visibilitychange",t)}),{}}},d=n(1241);const u=(0,d.A)(c,[["render",s]]);var m=u,p=n(5742),v=n(4232);const f={class:"d-flex flex-column align-items-center m-0 p-0 w-100 h-100 overflow-hidden position-relative"},y={ref:"nametagContainer",class:"pe-none",style:{position:"fixed","z-index":"10000","pointer-events":"none",top:"0",left:"0",right:"0",bottom:"0"}},h={ref:"mainContainer",class:"col-12 col-md-10 d-flex flex-column position-relative h-100 overflow-x-hidden"},g={ref:"contentContainer",class:"d-flex position-relative min-h-0 overflow-hidden my-flex-1-1-0"},x={ref:"leftSection",class:"my-side-section position-relative z-1 my-width-20"},b={ref:"centerSection",class:"flex-grow-1 my-flex-grow-1 position-relative min-w-0 min-h-0 overflow-hidden my-flex-1-1-0"},w={ref:"rightSection",class:"my-side-section position-relative z-3 my-width-20"},k={class:"d-flex flex-column gap-2 align-items-start justify-content-center position-absolute top-0 start-0 end-0 bottom-0 ps-2 pe-0"},L=["disabled"],C=["disabled"],S=["disabled"],E={ref:"svgContainer",class:"position-absolute top-0 start-0 end-0 bottom-0 z-2 pe-none"},R={ref:"boxesContainer",class:"position-absolute top-0 start-0 end-0 bottom-0 z-3 pe-none"},_={key:0,class:"my-loading-overlay text-center my-text-dark-gray"},M={key:1,class:"my-loading-overlay text-center my-text-dark-gray"},A={class:"d-flex flex-column align-items-center gap-2"},$={class:"d-flex flex-column gap-2 align-items-center"};function T(t,e,n,o,a,l){return(0,i.uX)(),(0,i.CE)("div",f,[(0,i.Lk)("div",y,null,512),(0,i.Lk)("div",h,[e[5]||(e[5]=(0,i.Fv)('<div class="d-flex"><div class="d-none d-md-block my-width-20"></div><div class="text-center text-md-start d-flex flex-column justify-content-center py-3 my-title-content"><div><h1 class="mb-0 my-text-lg my-color-light-gray">政治人物光譜</h1><div class="my-text-sm my-text-dark-gray pt-3"> 把名字拖曳到最適合的顏色位置，上傳後看結果唷！ </div></div></div><div class="d-none d-md-block my-side-section my-width-20"></div></div>',1)),(0,i.Lk)("div",g,[(0,i.Lk)("div",x,null,512),(0,i.Lk)("div",b,null,512),(0,i.Lk)("div",w,[(0,i.Lk)("div",k,[(0,i.Lk)("button",{class:(0,v.C4)(["btn my-button rounded px-2 py-1",{"cursor-not-allowed":!o.confirmEnabled||o.isSaving}]),disabled:!o.confirmEnabled||o.isSaving,onClick:e[0]||(e[0]=(...t)=>o.saveToSupabase&&o.saveToSupabase(...t)),type:"button"}," 確定送出 ",10,L),(0,i.Lk)("button",{class:(0,v.C4)(["btn my-button my-text-sm rounded px-2 py-1",{"cursor-not-allowed":o.isSaving}]),disabled:o.isSaving,onClick:e[1]||(e[1]=(...t)=>o.resetBoxes&&o.resetBoxes(...t)),type:"button"}," 全部重設 ",10,C),(0,i.Lk)("button",{class:(0,v.C4)(["btn my-button rounded px-2 py-1",{"cursor-not-allowed":!o.hasCookieId}]),disabled:!o.hasCookieId,onClick:e[2]||(e[2]=(...t)=>o.goToResult&&o.goToResult(...t)),type:"button"}," 查看結果 ",10,S)])],512),(0,i.Lk)("div",E,null,512),(0,i.Lk)("div",R,null,512)],512),e[6]||(e[6]=(0,i.Fv)('<div class="d-flex"><div class="d-none d-md-block my-width-20"></div><div class="d-flex justify-content-end align-items-center py-2 px-2 px-md-0 my-footer-content"><div class="my-text-sm my-text-dark-gray">szfftz</div></div><div class="d-none d-md-block my-width-20"></div></div>',1))],512),o.isSaving?((0,i.uX)(),(0,i.CE)("div",_,[...e[7]||(e[7]=[(0,i.Lk)("div",{class:"spinner-border mb-3 my-spinner-lg",role:"status"},[(0,i.Lk)("span",{class:"visually-hidden"},"上傳中...")],-1),(0,i.Lk)("p",{class:"mt-3 mb-0 my-text-sm my-text-dark-gray"},"上傳中",-1)])])):(0,i.Q3)("",!0),o.isSaveSuccess?((0,i.uX)(),(0,i.CE)("div",M,[(0,i.Lk)("div",A,[e[8]||(e[8]=(0,i.Lk)("h2",{class:"mb-4 my-text-lg my-text-dark-gray"},"上傳成功！",-1)),(0,i.Lk)("div",$,[(0,i.Lk)("button",{class:"btn my-button rounded px-2 py-1",onClick:e[3]||(e[3]=(...t)=>o.closeSuccessDialog&&o.closeSuccessDialog(...t)),type:"button"}," 確定 "),(0,i.Lk)("button",{class:"btn my-button rounded px-2 py-1",onClick:e[4]||(e[4]=(...t)=>o.goToResult&&o.goToResult(...t)),type:"button"}," 查看結果 ")])])])):(0,i.Q3)("",!0)])}n(4114),n(6573),n(8100),n(7936),n(8111),n(2489),n(116),n(7588),n(1701),n(3579),n(3110),n(7642),n(8004),n(3853),n(5876),n(2475),n(5024),n(1698),n(9577),n(8335),n(1549),n(9797),n(9631),n(5623),n(4979);var K=n(144),I=n(950),X=n(1540);const j="https://qkduucehkgwbdawkbkvl.supabase.co",O="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFrZHV1Y2Voa2d3YmRhd2tia3ZsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU4NjY0MjEsImV4cCI6MjA4MTQ0MjQyMX0.aaI_0RJ1ERZbJMhSo01GvQtmSXS-dx-an60y_jrfaJs",B=()=>j&&O&&!j.includes("YOUR_SUPABASE_URL")&&!O.includes("YOUR_SUPABASE_ANON_KEY")&&j.includes("supabase.co");let N=null;const z=()=>{if(!B())throw new Error("Supabase configuration incomplete. Please set SUPABASE_URL and SUPABASE_ANON_KEY");return N||(N=(0,X.UU)(j,O)),N},Y=["馬英九","蔡英文","賴清德","韓國瑜","柯文哲","傅崐萁","黃國昌","鄭麗文"];function F(t){const e=getComputedStyle(document.documentElement).getPropertyValue(t).trim();if(!e){const n={"--my-color-blue":"hsl(210, 85%, 65%)","--my-color-green":"hsl(150, 85%, 65%)","--my-color-red":"hsl(0, 85%, 65%)","--my-color-white":"hsl(210, 60%, 92%)","--my-color-yellow":"hsl(60, 98%, 63%)","--my-color-background-gray":"#dedede","--my-color-dark-gray":"#393939","--my-color-light-gray":"#7d7d7d","--my-color-highlight-gray":"#c8c8c8"};return n[t]||e}return e}function P({svg:t,colors:e,gradientAreaLeft:n,gradientAreaTop:o,gradientAreaWidth:a,gradientAreaHeight:i}){const l=e.blue||"hsl(210, 85%, 65%)",r=e.green||"hsl(150, 85%, 65%)",s=e.red||"hsl(0, 85%, 65%)",c=e.white||"hsl(210, 60%, 92%)",d=e.backgroundGray||"#dedede",u=t.append("defs"),m=u.append("radialGradient").attr("id","topLeftGradient").attr("gradientUnits","objectBoundingBox").attr("cx","0").attr("cy","0").attr("r","2.5");m.append("stop").attr("offset","0%").attr("stop-color",l).attr("stop-opacity","1.0"),m.append("stop").attr("offset","92%").attr("stop-color",l).attr("stop-opacity","0");const p=u.append("radialGradient").attr("id","topRightGradient").attr("gradientUnits","objectBoundingBox").attr("cx","1").attr("cy","0").attr("r","1.3");p.append("stop").attr("offset","0%").attr("stop-color",s).attr("stop-opacity","1.0"),p.append("stop").attr("offset","60%").attr("stop-color",s).attr("stop-opacity","0");const v=u.append("radialGradient").attr("id","bottomLeftGradient").attr("gradientUnits","objectBoundingBox").attr("cx","0").attr("cy","1").attr("r","1.5");v.append("stop").attr("offset","0%").attr("stop-color",r).attr("stop-opacity","1.0"),v.append("stop").attr("offset","70%").attr("stop-color",r).attr("stop-opacity","0");const f=u.append("radialGradient").attr("id","bottomRightGradient").attr("gradientUnits","objectBoundingBox").attr("cx","1").attr("cy","1").attr("r","1.5");f.append("stop").attr("offset","0%").attr("stop-color",c).attr("stop-opacity","1.0"),f.append("stop").attr("offset","70%").attr("stop-color",c).attr("stop-opacity","0"),t.append("rect").attr("x",n).attr("y",o).attr("width",a).attr("height",i).attr("fill",d),t.append("rect").attr("x",n).attr("y",o).attr("width",a).attr("height",i).attr("fill","url(#topLeftGradient)").attr("mix-blend-mode","screen"),t.append("rect").attr("x",n).attr("y",o).attr("width",a).attr("height",i).attr("fill","url(#topRightGradient)").attr("mix-blend-mode","screen"),t.append("rect").attr("x",n).attr("y",o).attr("width",a).attr("height",i).attr("fill","url(#bottomLeftGradient)").attr("mix-blend-mode","screen"),t.append("rect").attr("x",n).attr("y",o).attr("width",a).attr("height",i).attr("fill","url(#bottomRightGradient)").attr("mix-blend-mode","screen")}var G={name:"HomeView",setup(){const t=(0,p.rd)(),e=(0,K.KR)(null),n=(0,K.KR)(null),o=(0,K.KR)(null),a=(0,K.KR)(null),l=(0,K.KR)(null),r=(0,K.KR)(null),s=(0,K.KR)(null),c=(0,K.KR)(null),d=(0,K.KR)(null),u=(0,K.KR)(0);let m=null,v=null,f=[],y=null;const h=(0,K.KR)(!0),g=(0,K.KR)(0),x=(0,K.KR)(0),b=async()=>{if(B())try{const e=z();try{const{data:t,error:n}=await e.rpc("count_distinct_cookie_ids");if(!n&&null!==t&&void 0!==t)return void(x.value=t)}catch(t){return}const n=new Set,o=1e3;let a=0,i=!0;while(i){const{data:t,error:l}=await e.from("data").select("cookie_id").not("cookie_id","is",null).order("id",{ascending:!0}).range(a,a+o-1);if(l)return void(x.value=0);t&&t.length>0?(t.forEach(t=>{null!==t.cookie_id&&void 0!==t.cookie_id&&n.add(t.cookie_id)}),a+=o,t.length<o&&(i=!1)):i=!1}x.value=n.size}catch(e){x.value=0}else x.value=0},w=()=>({blue:F("--my-color-blue"),green:F("--my-color-green"),red:F("--my-color-red"),white:F("--my-color-white"),backgroundGray:F("--my-color-background-gray"),darkGray:F("--my-color-dark-gray")}),k=60,L=k*(4/3),C=30;let S=0,E=0,R=0,_=0;const M=(0,K.KR)(!1),A=(0,K.KR)(!1),$=(0,K.KR)(null),T=(0,K.KR)(null),X=(0,K.KR)(null),j=(0,K.KR)(!1),O=(t,e,n,o,a)=>t.x>=e&&t.x<=o&&t.y>=n&&t.y<=a,N=(t,o,a,i,l)=>{if(!e.value||!n.value)return;const s=0,c=t,d=s,u=c+o,m=d+a;r.value&&(r.value.innerHTML="");const p=n.value.getBoundingClientRect();f.forEach(e=>{const o=document.createElement("div");o.className="my-name-box cursor-grab position-absolute d-flex align-items-center justify-content-center text-dark user-select-none bg-transparent border-0",o.setAttribute("data-name",e.name),o.style.width=`${L}px`,o.style.height=`${C}px`,o.style.pointerEvents="auto";const a=p.left+e.x,i=p.top+e.y,s=-L/2,v=-C/2;o.style.transform=`translate(${s}px, ${v}px)`,o.style.left=`${a}px`,o.style.top=`${i}px`;const f=document.createElement("div");f.className="position-relative d-inline-block px-2 py-1 rounded bg-transparent";const y=document.createElement("span");y.className="my-name-box-text position-relative lh-1 text-nowrap",y.textContent=e.name,f.appendChild(y),o.appendChild(f);let h=!1,g=e,x=null;const b=t=>{h&&g===e&&n.value&&(t?.type?.startsWith?.("touch")&&t.cancelable&&t.preventDefault(),x&&cancelAnimationFrame(x),x=requestAnimationFrame(()=>{const a=n.value.getBoundingClientRect();let i,l;if(t.type.startsWith("touch")){const e=t.touches[0]||t.changedTouches[0];i=e.clientX-a.left,l=e.clientY-a.top}else i=t.clientX-a.left,l=t.clientY-a.top;const r=a.width,s=a.height,c=0,d=r,u=0,m=s,p=Math.max(c,Math.min(d,i)),v=Math.max(u,Math.min(m,l));e.x=p,e.y=v;const f=a.left+p,y=a.top+v,h=-L/2,g=-C/2;o.style.transform=`translate(${h}px, ${g}px)`,o.style.left=`${f}px`,o.style.top=`${y}px`,J()}))},w=()=>{if(!h||g!==e)return;h=!1,o.style.zIndex="1",o.classList.remove("my-dragging"),x&&(cancelAnimationFrame(x),x=null);const a=O(e,c,d,u,m);if(a)G(t,l);else if(e.x<t)G(t,l);else{o.classList.add("my-smooth-transition"),e.x=e.defaultX,e.y=e.defaultY;const a=n.value.getBoundingClientRect(),i=a.left+e.x,r=a.top+e.y,s=-L/2,c=-C/2;o.style.transform=`translate(${s}px, ${c}px)`,o.style.left=`${i}px`,o.style.top=`${r}px`,setTimeout(()=>{o.classList.remove("my-smooth-transition")},300),G(t,l)}J(),document.removeEventListener("mousemove",b),document.removeEventListener("mouseup",w),document.removeEventListener("touchmove",b),document.removeEventListener("touchend",w),document.removeEventListener("touchcancel",w)},k=t=>{h=!0,g=e,o.style.zIndex="1000",o.classList.add("my-dragging"),document.addEventListener("mousemove",b),document.addEventListener("mouseup",w),document.addEventListener("touchmove",b,{passive:!1}),document.addEventListener("touchend",w),document.addEventListener("touchcancel",w),t.preventDefault()};o.addEventListener("mousedown",k),o.addEventListener("touchstart",k,{passive:!1}),r.value&&r.value.appendChild(o)}),G(t,l)},G=(t,e)=>{if(!r.value||!n.value)return;let o=f.filter(e=>e.x<t).sort((t,e)=>{const n=Y.indexOf(t.name),o=Y.indexOf(e.name);return n-o});if(0===o.length)return;const a=0,i=C+20,l=o.length*i-20,s=e-a,c=a+(s-l)/2+C/2,d=Math.max(a+C/2,c),u=10,m=t-L/2-u;o.forEach((t,e)=>{const n=m,o=d+e*i;t.x=n,t.y=o,t.defaultX=n,t.defaultY=o});const p=n.value.getBoundingClientRect();r.value&&f.forEach(t=>{const e=r.value.querySelector(`[data-name="${t.name}"]`);if(e){e.classList.add("my-smooth-transition");const n=p.left+t.x,o=p.top+t.y,a=-L/2,i=-C/2;e.style.transform=`translate(${a}px, ${i}px)`,e.style.left=`${n}px`,e.style.top=`${o}px`,setTimeout(()=>{e.classList.remove("my-smooth-transition")},300)}})},U=t=>!t||t<=0?0:.2*t,D=(t,e=0,n=null)=>{const o=[],a=C+20,i=Y,l=i.length*a-20;let r=C/2;if(n){const t=(n-l)/2+C/2;r=Math.max(C/2,t)}const s=10,c=e+t-L/2-s;return i.forEach((t,e)=>{const n=c,i=r+e*a;o.push({x:n,y:i,defaultX:n,defaultY:i,name:t})}),o},J=()=>{if(!y||!m||!o.value)return;if(!n.value)return;const t=n.value.getBoundingClientRect(),e=t.height,a=t.width,i=U(a),l=U(a);u.value=l;const r=0,s=a-i-l,c=e-r,d=i,p=r,v=d+s,g=p+c;y.selectAll("*").remove();const x=[];f.forEach((t,e)=>{const n=O(t,d,p,v,g);if(n){const n=t.x-d,o=t.y-p,a=Math.max(0,Math.min(100,n/s*100)),i=Math.max(0,Math.min(100,o/c*100));x.push({name:t.name||`方塊 ${e+1}`,x:t.x,y:t.y,xPercent:Math.round(100*a)/100,yPercent:Math.round(100*i)/100})}});const b=x.map(t=>t.name),w=Y.some(t=>!b.includes(t)),k=!w,L=h.value;h.value=k,(k||L===k&&!b.length)&&x.sort((t,e)=>t.xPercent-e.xPercent)},H=()=>{if(!o.value||!n.value)return;const t=w(),e=t.blue&&t.green&&t.red&&t.white&&t.backgroundGray;if(!e)return void requestAnimationFrame(()=>{setTimeout(()=>{H()},50)});I.Ltv(o.value).selectAll("svg").remove();const a=n.value.getBoundingClientRect(),i=a.width,l=a.height;if(i<=0||l<=0)return void requestAnimationFrame(()=>{H()});const r=U(i),s=U(i);u.value=s;const c=0,d=i-r-s,p=l-c,v=r,h=c;if(m=I.Ltv(o.value).append("svg").attr("width",i).attr("height",l).attr("class","d-block position-relative w-100 h-100").style("pointer-events","none"),P({svg:m,colors:t,gradientAreaLeft:v,gradientAreaTop:h,gradientAreaWidth:d,gradientAreaHeight:p}),y=m.append("g").attr("class","position-lines"),g.value=Y.length,0===f.length)f=D(r,0,l);else{const t=D(r,0,l);f=t.map((t,e)=>{const n=f[e];return{...n,x:n?n.x:t.x,y:n?n.y:t.y,defaultX:n&&n.defaultX?n.defaultX:t.defaultX,defaultY:n&&n.defaultY?n.defaultY:t.defaultY,name:t.name}})}if(N(r,d,p,s,l),requestAnimationFrame(()=>{J()}),n.value){const t=n.value.getBoundingClientRect();S=t.width,E=t.height,R=r,_=s}},V=()=>{v&&clearTimeout(v),v=setTimeout(()=>{if(!n.value)return;const t=n.value.getBoundingClientRect(),e=t.width,o=t.height,a=U(e),i=U(e),l=e-a-i,r=o,s=a,c=0,d=s+l,u=c+r,p=e/S,v=o/E;f=f.map(t=>{const e=R>0&&t.x<R;let n,i,m,f;if(e){const e=R>0?t.defaultX/R:.5;n=Math.max(0,Math.min(a,a*e)),i=Math.max(0,Math.min(o,t.y*v));const l=D(a,0,o),r=l.find(e=>e.name===t.name);r?(m=r.defaultX,f=r.defaultY):(m=n,f=i)}else{const e=S-R-_,y=E,h=R,g=0;if(e>0&&y>0){const o=(t.x-h)/e,a=(t.y-g)/y,m=Math.max(0,Math.min(1,o)),p=Math.max(0,Math.min(1,a));n=s+m*l,i=c+p*r;const v=s,f=d,x=c,b=u;n=Math.max(v,Math.min(f,n)),i=Math.max(x,Math.min(b,i))}else n=t.x*p,i=t.y*v;const x=D(a,0,o),b=x.find(e=>e.name===t.name);b?(m=b.defaultX,f=b.defaultY):(m=Math.max(0,Math.min(a,t.defaultX)),f=t.defaultY*v)}return{...t,x:n,y:i,defaultX:m,defaultY:f}}),m&&m.attr("width",e).attr("height",o),H()},100)},W=async t=>{try{const e=Date.now().toString(),n=Math.random().toString(36).substring(2,15),o=JSON.stringify(t),a=`${e}-${n}-${o}`,i=new TextEncoder,l=i.encode(a),r=await crypto.subtle.digest("SHA-256",l),s=Array.from(new Uint8Array(r)),c=s.map(t=>t.toString(16).padStart(2,"0")).join("");return c.substring(0,32)}catch(e){const n=Date.now().toString(36),o=Math.random().toString(36).substring(2,15),a=btoa(JSON.stringify(t)).substring(0,10);return`${n}-${o}-${a}`}},q={set(t,e,n=365){const o=new Date;o.setTime(o.getTime()+24*n*60*60*1e3);const a="https:"===window.location.protocol,i=a?"; Secure":"";document.cookie=`${t}=${encodeURIComponent(e)};expires=${o.toUTCString()};path=/; SameSite=Lax${i}`},get(t){const e=t+"=",n=document.cookie.split(";");for(let o=0;o<n.length;o++){let t=n[o];while(" "===t.charAt(0))t=t.substring(1,t.length);if(0===t.indexOf(e))return decodeURIComponent(t.substring(e.length,t.length))}return null},test(){try{const t="cookie_test_"+Date.now();this.set(t,"test",1);const e="test"===this.get(t);return this.remove(t),e}catch(t){return!1}},remove(t){document.cookie=`${t}=;expires=Thu, 01 Jan 1970 00:00:00 UTC;path=/;`}},Q=()=>{document.hidden||b()};(0,i.sV)(()=>{q.test(),b(),document.addEventListener("visibilitychange",Q);const t=q.get("political-spectrum_id");if(t?($.value=t,j.value=!0):j.value=!1,t){const t=q.get("political-spectrum_created_at");t&&(T.value=t);const e=q.get("political-spectrum_update_at");e&&(X.value=e)}let e=!1,o=null;const a=q.get("political-spectrum_positions");if(a)try{const t=JSON.parse(a);t&&"object"===typeof t&&(o=t,e=Y.some(t=>{const e=o?.[t];return e&&void 0!==e.x&&void 0!==e.y&&null!==e.x&&null!==e.y}))}catch(l){o=null}e||(e=Y.some(t=>{const e=q.get(`political-spectrum_${t}_x`),n=q.get(`political-spectrum_${t}_y`);return null!==e&&null!==n})),(0,i.dY)(()=>{requestAnimationFrame(()=>{if(!n.value)return;const t=n.value.getBoundingClientRect(),a=t.width,i=t.height;if(a<=0||i<=0)return void setTimeout(()=>{if(!n.value)return;const t=n.value.getBoundingClientRect();t.width>0&&t.height>0&&H()},100);const l=U(a),r=D(l,0,i);if(e){if(!n.value)return;const t=n.value.getBoundingClientRect(),e=t.width,a=t.height,i=U(e);u.value=i;const s=e-l-i,c=a,d=l,m=0;f=Y.map((t,e)=>{const n=r[e],a=o?.[t],i=void 0!==a?.x&&null!==a?.x?String(a.x):q.get(`political-spectrum_${t}_x`),l=void 0!==a?.y&&null!==a?.y?String(a.y):q.get(`political-spectrum_${t}_y`);let u=n.x,p=n.y;if(null!==i&&null!==l&&"-1"!==i&&"-1"!==l){const t=parseFloat(i),e=parseFloat(l);u=d+t/100*s,p=m+e/100*c}return{x:u,y:p,defaultX:n.defaultX,defaultY:n.defaultY,name:t}}),G(l,a)}else f=r;H(),window.addEventListener("resize",V)})})});const Z=async()=>{if(!M.value){M.value=!0;try{if(!n.value)return;const e=n.value.getBoundingClientRect(),o=e.width,a=e.height,i=U(o),l=U(o);u.value=l;const r=o-i-l,s=a,c=i,d=0,m=c+r,p=d+s,v=Y.map(t=>{const e=f.find(e=>e.name===t);let n=-1,o=-1;if(e){const t=O(e,c,d,m,p);if(t){const t=e.x-c,a=Math.max(0,Math.min(100,t/r*100));n=Math.round(100*a)/100;const i=e.y-d,l=Math.max(0,Math.min(100,i/s*100));o=Math.round(100*l)/100}}return{name:t,x:n,y:o}});let y=$.value;y||(y=await W(v),$.value=y);const h=(new Date).toISOString(),g=v.map(t=>({cookie_id:y,name:t.name,x:t.x,y:t.y,update_at:h}));q.set("political-spectrum_id",y,365);const x=(new Date).toLocaleString("zh-TW",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"});T.value||(T.value=x,q.set("political-spectrum_created_at",x,365)),X.value=x,q.set("political-spectrum_update_at",x,365);const w={};if(f.forEach(t=>{const e=O(t,c,d,m,p);if(e){const e=t.x-c,n=Math.max(0,Math.min(100,e/r*100)).toFixed(2),o=t.y-d,a=Math.max(0,Math.min(100,o/s*100)).toFixed(2);w[t.name]={x:n,y:a}}else w[t.name]={x:"-1",y:"-1"}}),q.set("political-spectrum_positions",JSON.stringify(w),365),$.value=y,j.value=!0,J(),!B())return M.value=!1,void t.push("/");const k=z(),{data:L,error:C}=await k.from("data").select("id").order("id",{ascending:!1}).limit(1).maybeSingle();if(C)throw new Error(`查詢最大ID時發生錯誤: ${C.message}`);const S=L?.id||0,E=[],R=[];let _=S+1;for(const t of g){const{data:e,error:n}=await k.from("data").select("id").eq("cookie_id",t.cookie_id).eq("name",t.name).maybeSingle();if(n)throw new Error(`查詢記錄時發生錯誤: ${n.message}`);e?R.push({id:e.id,x:t.x,y:t.y,update_at:t.update_at}):E.push({...t,id:_++})}if(E.length>0){const{error:t}=await k.from("data").insert(E);if(t)throw new Error(`插入數據時發生錯誤: ${t.message}`)}if(R.length>0)for(const t of R){const{error:e}=await k.from("data").update({x:t.x,y:t.y,update_at:t.update_at}).eq("id",t.id);if(e)throw new Error(`更新數據時發生錯誤: ${e.message}`)}await b(),A.value=!0}catch(e){t.push("/")}finally{M.value=!1}}},tt=()=>{if(!n.value)return;const t=n.value.getBoundingClientRect(),e=t.width,o=t.height,a=U(e),i=D(a,0,o);f.forEach((t,e)=>{i[e]&&(t.x=i[e].defaultX,t.y=i[e].defaultY,t.defaultX=i[e].defaultX,t.defaultY=i[e].defaultY)}),H()};(0,i.hi)(()=>{window.removeEventListener("resize",V),document.removeEventListener("visibilitychange",Q),v&&clearTimeout(v)});const et=()=>{A.value=!1,t.push("/result")},nt=()=>{A.value=!1},ot=t=>{const e=I.GPZ(",");return e(t)},at=(0,i.EW)(()=>ot(x.value));return{mainContainer:e,contentContainer:n,svgContainer:o,buttonContainer:a,boxesContainer:l,nametagContainer:r,leftSection:s,centerSection:c,rightSection:d,rightSectionWidth:u,confirmEnabled:h,isSaving:M,isSaveSuccess:A,totalCookieIds:x,formattedTotalCookieIds:at,hasCookieId:j,saveToSupabase:Z,resetBoxes:tt,goToResult:et,closeSuccessDialog:nt}}};const U=(0,d.A)(G,[["render",T]]);var D=U;const J={class:"d-flex flex-column align-items-center m-0 p-0 w-100 h-100 overflow-hidden position-relative"},H={ref:"diamondContainer",class:"pe-none",style:{position:"fixed","z-index":"10000","pointer-events":"none",top:"0",left:"0",right:"0",bottom:"0"}},V={ref:"mainContainer",class:"col-12 col-md-10 d-flex flex-column position-relative h-100 overflow-x-hidden"},W={class:"d-flex"},q={class:"text-center text-md-start d-flex flex-column justify-content-center py-3 my-title-content"},Q={class:"mb-0 my-text-lg my-color-light-gray"},Z={ref:"contentContainer",class:"d-flex position-relative min-w-0 min-h-0 overflow-hidden my-flex-1-1-0"},tt={ref:"leftSection",class:"my-side-section position-relative z-1 my-width-20"},et={class:"d-flex flex-column gap-2 align-items-end justify-content-center position-absolute top-0 start-0 end-0 bottom-0 pe-2 ps-0"},nt={ref:"centerSection",class:"flex-grow-1 my-flex-grow-1 position-relative min-w-0 min-h-0 overflow-hidden my-flex-1-1-0"},ot={ref:"rightSection",class:"my-side-section position-relative z-3 my-width-20"},at={class:"left-section d-flex flex-column align-items-start justify-content-center position-absolute top-0 start-0 end-0 bottom-0 ps-2 pe-0 overflow-y-auto gap-4"},it=["onClick"],lt={ref:"svgContainer",class:"position-absolute top-0 start-0 end-0 bottom-0 z-2 pe-none"},rt={ref:"boxesContainer",class:"position-absolute top-0 start-0 end-0 bottom-0 z-3 pe-none"},st={class:"d-flex"},ct={class:"d-flex justify-content-between align-items-center py-2 px-2 px-md-0 my-footer-content"},dt={class:"d-flex align-items-center gap-3"},ut={class:"my-text-sm my-text-dark-gray"},mt={key:0,class:"my-loading-overlay text-center my-text-dark-gray"},pt={key:1,class:"my-error-overlay text-center p-5 rounded my-text-dark-gray"},vt={class:"alert alert-danger mb-0",role:"alert"};function ft(t,e,n,o,a,l){return(0,i.uX)(),(0,i.CE)("div",J,[(0,i.Lk)("div",H,null,512),(0,i.Lk)("div",V,[(0,i.Lk)("div",W,[e[2]||(e[2]=(0,i.Lk)("div",{class:"d-none d-md-block my-width-20"},null,-1)),(0,i.Lk)("div",q,[(0,i.Lk)("div",null,[(0,i.Lk)("h1",Q,(0,v.v_)(o.selectedName?`${o.selectedName}的光譜`:"政治人物的光譜"),1),e[1]||(e[1]=(0,i.Lk)("div",{class:"my-text-sm my-text-dark-gray pt-3"},[(0,i.Lk)("i",{class:"fa-solid fa-diamond my-diamond-icon"}),(0,i.eW)(" 是你放的位置 ")],-1))])]),e[3]||(e[3]=(0,i.Lk)("div",{class:"d-none d-md-block my-side-section my-width-20"},null,-1))]),(0,i.Lk)("div",Z,[(0,i.Lk)("div",tt,[(0,i.Lk)("div",et,[(0,i.Lk)("button",{class:"btn my-button my-text-sm rounded px-2 py-1 d-flex flex-column align-items-center",onClick:e[0]||(e[0]=(...t)=>o.goHome&&o.goHome(...t)),type:"button"},[...e[4]||(e[4]=[(0,i.Lk)("div",{class:"d-flex align-items-center justify-content-center rounded-circle mt-2 my-size-32 my-border-dark-gray"},[(0,i.Lk)("i",{class:"fas fa-arrow-left"})],-1),(0,i.Lk)("span",{class:"mt-2"},"返回首頁",-1)])])])],512),(0,i.Lk)("div",nt,null,512),(0,i.Lk)("div",ot,[(0,i.Lk)("div",at,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(o.POLITICIAN_NAMES,t=>((0,i.uX)(),(0,i.CE)("button",{key:t,class:(0,v.C4)(["btn my-button my-text-sm rounded px-2 py-1",{active:o.selectedName===t}]),onClick:e=>o.handleNameClick(t),type:"button"},(0,v.v_)(t),11,it))),128))])],512),(0,i.Lk)("div",lt,null,512),(0,i.Lk)("div",rt,null,512)],512),(0,i.Lk)("div",st,[e[6]||(e[6]=(0,i.Lk)("div",{class:"d-none d-md-block my-width-20"},null,-1)),(0,i.Lk)("div",ct,[(0,i.Lk)("div",dt,[(0,i.Lk)("span",ut,"共有 "+(0,v.v_)(o.totalDataPoints)+" 個點",1)]),e[5]||(e[5]=(0,i.Lk)("div",{class:"my-text-sm my-text-dark-gray"},"szfftz",-1))]),e[7]||(e[7]=(0,i.Lk)("div",{class:"d-none d-md-block my-width-20"},null,-1))])],512),o.loading?((0,i.uX)(),(0,i.CE)("div",mt,[...e[8]||(e[8]=[(0,i.Lk)("div",{class:"spinner-border mb-3 my-spinner-lg",role:"status"},[(0,i.Lk)("span",{class:"visually-hidden"},"載入中...")],-1),(0,i.Lk)("p",{class:"mt-3 mb-0 my-text-sm my-text-dark-gray"},"正在載入數據...",-1)])])):(0,i.Q3)("",!0),o.error?((0,i.uX)(),(0,i.CE)("div",pt,[(0,i.Lk)("div",vt,[e[9]||(e[9]=(0,i.Lk)("i",{class:"bi bi-exclamation-triangle-fill me-2"},null,-1)),e[10]||(e[10]=(0,i.Lk)("strong",null,"錯誤：",-1)),(0,i.eW)((0,v.v_)(o.error),1)])])):(0,i.Q3)("",!0)])}var yt={name:"ResultView",setup(){const t=(0,p.rd)(),e=(0,K.KR)(null),n=(0,K.KR)(null),o=(0,K.KR)(null),a=(0,K.KR)(null),l=(0,K.KR)(null),r=(0,K.KR)(null),s=(0,K.KR)(null),c=(0,K.KR)(null),d=(0,K.KR)(0);let u=null,m=null;const v=(0,K.KR)(!1),f=(0,K.KR)(null),y=(0,K.KR)([]),h=(0,K.KR)(0),g=(0,K.KR)(null),x=(0,K.KR)([]),b={blue:F("--my-color-blue"),green:F("--my-color-green"),red:F("--my-color-red"),white:F("--my-color-white"),yellow:F("--my-color-yellow"),dataPoint:F("--my-color-data-point"),backgroundGray:F("--my-color-background-gray"),darkGray:F("--my-color-dark-gray")},w={get(t){const e=t+"=",n=document.cookie.split(";");for(let o=0;o<n.length;o++){let t=n[o];while(" "===t.charAt(0))t=t.substring(1,t.length);if(0===t.indexOf(e))return decodeURIComponent(t.substring(e.length,t.length))}return null}},k=()=>{const t=new Map;let e=null;const n=w.get("political-spectrum_positions");if(n)try{const t=JSON.parse(n);t&&"object"===typeof t&&(e=t)}catch(o){e=null}Y.forEach(n=>{const o=e?.[n],a=void 0!==o?.x&&null!==o?.x?String(o.x):w.get(`political-spectrum_${n}_x`),i=void 0!==o?.y&&null!==o?.y?String(o.y):w.get(`political-spectrum_${n}_y`);null!==a&&null!==i&&"-1"!==a&&"-1"!==i&&void 0!==a&&void 0!==i&&t.set(n,{name:n,x:parseFloat(a),y:parseFloat(i)})}),x.value=Array.from(t.values())},L=t=>!t||t<=0?0:.2*t,C=async(t=null)=>{if(y.value=[],o.value&&I.Ltv(o.value).selectAll("svg").remove(),!B())return f.value="Supabase 配置未完成",v.value=!1,h.value=0,void setTimeout(()=>{E()},100);try{const e=z(),n=[],o=1e3;let a=0,i=!0,l=null;while(i){let r=e.from("data").select("*",{count:"exact"});t&&(r=r.eq("name",t));const{data:s,error:c,count:d}=await r.order("update_at",{ascending:!1}).range(a,a+o-1);if(c)throw new Error(`查詢數據時發生錯誤: ${c.message}`);null!==d&&null===l&&(l=d),s&&s.length>0?(n.push(...s),a+=o,s.length<o&&(i=!1)):i=!1}const r=n;if(!r)return y.value=[],h.value=0,v.value=!1,k(),void setTimeout(()=>{E()},100);const s=r.filter(t=>{const e=parseFloat(t.x),n=parseFloat(t.y);return-1!==e&&-1!==n&&null!==t.x&&null!==t.y&&void 0!==t.x&&void 0!==t.y&&!isNaN(e)&&!isNaN(n)});y.value=s,h.value=null!==l?l:r?r.length:0}catch(e){f.value=e.message,h.value=0}finally{v.value=!1,k(),setTimeout(()=>{E()},100)}},S=t=>{g.value===t?(g.value=null,y.value=[],h.value=0,v.value=!1,o.value&&I.Ltv(o.value).selectAll("svg").remove(),k(),setTimeout(()=>{E()},100)):(g.value=t,v.value=!0,C(g.value))},E=()=>{if(!o.value||!n.value)return;I.Ltv(o.value).selectAll("svg").remove();const t=n.value.getBoundingClientRect(),e=t.width,a=t.height,i=L(e),r=L(e);d.value=r;const s=0,c=e-i-r,m=a-s,p=i,v=s;if(u=I.Ltv(o.value).append("svg").attr("width",e).attr("height",a).attr("class","d-block position-relative w-100 h-100").style("pointer-events","none"),P({svg:u,colors:b,gradientAreaLeft:p,gradientAreaTop:v,gradientAreaWidth:c,gradientAreaHeight:m}),y.value.length>0){const t=y.value.map(t=>{const e=parseFloat(t.x),n=parseFloat(t.y),o=p+e/100*c,a=v+n/100*m;return{name:t.name,x:o,y:a,xPercent:e,yPercent:n}}),e=u.append("g").attr("class","data-points");t.forEach(t=>{e.append("circle").attr("cx",t.x).attr("cy",t.y).attr("r",2).attr("fill",b.darkGray).attr("opacity",.5)})}if(l.value&&n.value&&(l.value.innerHTML="",g.value&&x.value.length>0)){const t=x.value.find(t=>t.name===g.value);if(t){const e=parseFloat(t.x),o=parseFloat(t.y),a=p+e/100*c,i=v+o/100*m,r=n.value.getBoundingClientRect(),s=r.left+a,d=r.top+i,u=16,f=u/2,y=document.createElement("div");y.className="position-absolute d-flex align-items-center justify-content-center",y.style.left=s-f+"px",y.style.top=d-f+"px",y.style.width=`${u}px`,y.style.height=`${u}px`,y.setAttribute("data-name",t.name);const h=document.createElement("i");h.className="fa-solid fa-diamond my-diamond-icon",h.style.fontSize=`${u}px`,y.appendChild(h),l.value.appendChild(y)}}},R=()=>{m&&clearTimeout(m),m=setTimeout(()=>{!v.value&&y.value.length>0&&E()},100)},_=()=>{t.push("/")};return(0,i.sV)(()=>{const e=w.get("political-spectrum_id");e?(k(),Y.length>0?(g.value=Y[0],v.value=!0,C(g.value)):v.value=!1,window.addEventListener("resize",R)):t.push("/")}),(0,i.hi)(()=>{window.removeEventListener("resize",R),m&&clearTimeout(m)}),{mainContainer:e,contentContainer:n,svgContainer:o,boxesContainer:a,diamondContainer:l,leftSection:r,centerSection:s,rightSection:c,rightSectionWidth:d,loading:v,error:f,goHome:_,POLITICIAN_NAMES:Y,selectedName:g,handleNameClick:S,allDataPoints:y,totalDataPoints:h}}};const ht=(0,d.A)(yt,[["render",ft]]);var gt=ht;const xt=[{path:"/",name:"Home",component:D},{path:"/result",name:"Result",component:gt}],bt=()=>{if("undefined"!==typeof window){if(window.location.hostname.includes("netlify.app")||window.location.hostname.includes("netlify.com"))return"/";if(window.location.hostname.includes("github.io")||"localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname)return"/political-spectrum/"}return"/political-spectrum/"},wt=(0,p.aE)({history:(0,p.LA)(bt()),routes:xt});wt.afterEach(t=>{"undefined"!==typeof window&&window.gtag&&window.gtag("config","G-W4V1DVT65L",{page_path:t.fullPath})});var kt=wt;n(323);const Lt=(0,o.Ef)(m),Ct=(0,a.Ey)();Lt.use(kt),Lt.use(Ct),Lt.mount("#app")}},e={};function n(o){var a=e[o];if(void 0!==a)return a.exports;var i=e[o]={exports:{}};return t[o].call(i.exports,i,i.exports,n),i.exports}n.m=t,function(){var t=[];n.O=function(e,o,a,i){if(!o){var l=1/0;for(d=0;d<t.length;d++){o=t[d][0],a=t[d][1],i=t[d][2];for(var r=!0,s=0;s<o.length;s++)(!1&i||l>=i)&&Object.keys(n.O).every(function(t){return n.O[t](o[s])})?o.splice(s--,1):(r=!1,i<l&&(l=i));if(r){t.splice(d--,1);var c=a();void 0!==c&&(e=c)}}return e}i=i||0;for(var d=t.length;d>0&&t[d-1][2]>i;d--)t[d]=t[d-1];t[d]=[o,a,i]}}(),function(){n.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return n.d(e,{a:e}),e}}(),function(){n.d=function(t,e){for(var o in e)n.o(e,o)&&!n.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:e[o]})}}(),function(){n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()}(),function(){n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}}(),function(){n.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}}(),function(){var t={524:0};n.O.j=function(e){return 0===t[e]};var e=function(e,o){var a,i,l=o[0],r=o[1],s=o[2],c=0;if(l.some(function(e){return 0!==t[e]})){for(a in r)n.o(r,a)&&(n.m[a]=r[a]);if(s)var d=s(n)}for(e&&e(o);c<l.length;c++)i=l[c],n.o(t,i)&&t[i]&&t[i][0](),t[i]=0;return n.O(d)},o=self["webpackChunkpolitical_spectrum"]=self["webpackChunkpolitical_spectrum"]||[];o.forEach(e.bind(null,0)),o.push=e.bind(null,o.push.bind(o))}();var o=n.O(void 0,[504],function(){return n(5564)});o=n.O(o)})();
//# sourceMappingURL=app.d2739b5e.js.map